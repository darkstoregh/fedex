{"version":3,"sources":["../src/index.js"],"names":["log","request","response","FedExAPI","account_number","environment","meter_number","key","password","isProduction","endpoint","serviceTypes","SigningOptions","SO","params","cb","resource","version","ServiceId","Major","Intermediate","Minor","_request","err","res","service","error","options","description","code","serviceOption","_","find","list","o","name","data","fn","wsdl","path","join","__dirname","client","_generateAuthentication","result","root","Envelope","Body","Fault","e","lastRequest","WebAuthenticationDetail","UserCredential","Key","Password","ClientDetail","AccountNumber","MeterNumber","Version","extend"],"mappings":"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","sourcesContent":["import path from 'path';\nimport _ from 'lodash';\nimport { createClient } from 'soap';\nimport debug from 'debug';\n\nimport { serviceTypes, SO } from './serviceTypes';\n\nconst log = debug('fedex');\nlog.request = debug('fedex:request');\nlog.response = debug('fedex:response');\n\nexport default class FedExAPI {\n  constructor({ account_number, environment, meter_number, key, password, isProduction }) {\n    this.account_number = account_number;\n    this.endpoint = environment === 'production' ? 'https://ws.fedex.com' : 'https://wsbeta.fedex.com';\n    this.environment = environment === 'production';\n    this.isProduction = isProduction;\n    this.key = key;\n    this.meter_number = meter_number;\n    this.password = password;\n    this.serviceTypes = serviceTypes;\n    this.SigningOptions = SO;\n  }\n\n  addressvalidation(params, cb) {\n    const resource = {\n      version: {\n        ServiceId: 'aval',\n        Major: 4,\n        Intermediate: 0,\n        Minor: 0,\n      },\n    };\n\n    this._request(params, 'addressValidation', 'AddressValidationService_v4.wsdl', resource, (err, res) => {\n      return cb(err, res);\n    });\n  }\n\n  availability(params, cb) {\n    const resource = {\n      version: {\n        ServiceId: 'vacs',\n        Major: 6,\n        Intermediate: 0,\n        Minor: 0,\n      },\n    };\n\n    this._request(\n      params,\n      'serviceAvailability',\n      'ValidationAvailabilityAndCommitmentService_v6.wsdl',\n      resource,\n      (err, res) => {\n        return cb(err, res);\n      },\n    );\n  }\n\n  cancelPickup(params, cb) {\n    const resource = {\n      version: {\n        ServiceId: 'disp',\n        Major: 13,\n        Intermediate: 0,\n        Minor: 0,\n      },\n    };\n\n    this._request(params, 'cancelPickup', 'PickupService_v13.wsdl', resource, (err, res) => {\n      return cb(err, res);\n    });\n  }\n\n  pickup(params, cb) {\n    const resource = {\n      version: {\n        ServiceId: 'disp',\n        Major: 13,\n        Intermediate: 0,\n        Minor: 0,\n      },\n    };\n\n    this._request(params, 'createPickup', 'PickupService_v13.wsdl', resource, (err, res) => {\n      return cb(err, res);\n    });\n  }\n\n  pickupAvailability(params, cb) {\n    const resource = {\n      version: {\n        ServiceId: 'disp',\n        Major: 13,\n        Intermediate: 0,\n        Minor: 0,\n      },\n    };\n\n    this._request(params, 'getPickupAvailability', 'PickupService_v13.wsdl', resource, (err, res) => {\n      return cb(err, res);\n    });\n  }\n\n  rates(params, cb) {\n    const resource = {\n      version: {\n        ServiceId: 'crs',\n        Major: 20,\n        Intermediate: 0,\n        Minor: 0,\n      },\n    };\n\n    this._request(params, 'getRates', 'RateService_v20.wsdl', resource, (err, res) => {\n      return cb(err, res);\n    });\n  }\n\n  freight_rates(params, cb) {\n    const resource = {\n      version: {\n        ServiceId: 'crs',\n        Major: 20,\n        Intermediate: 0,\n        Minor: 0,\n      },\n    };\n\n    this._request(params, 'getRates', 'RateService_v20.wsdl', resource, (err, res) => {\n      return cb(err, res);\n    });\n  }\n\n  ship(params, cb) {\n    const resource = {\n      version: {\n        ServiceId: 'ship',\n        Major: 19,\n        Intermediate: 0,\n        Minor: 0,\n      },\n    };\n\n    this._request(params, 'processShipment', 'ShipService_v19.wsdl', resource, (err, res) => {\n      return cb(err, res);\n    });\n  }\n\n  deleteshipment(params, cb) {\n    const resource = {\n      version: {\n        ServiceId: 'ship',\n        Major: 19,\n        Intermediate: 0,\n        Minor: 0,\n      },\n    };\n\n    this._request(params, 'deleteShipment', 'ShipService_v19.wsdl', resource, (err, res) => {\n      return cb(err, res);\n    });\n  }\n\n  track(params, cb) {\n    const resource = {\n      version: {\n        ServiceId: 'trck',\n        Major: 12,\n        Intermediate: 0,\n        Minor: 0,\n      },\n    };\n\n    this._request(params, 'track', 'TrackService_v12.wsdl', resource, (err, res) => {\n      return cb(err, res);\n    });\n  }\n\n  smartpostclose(params, cb) {\n    const resource = {\n      version: {\n        ServiceId: 'clos',\n        Major: 4,\n        Intermediate: 0,\n        Minor: 0,\n      },\n    };\n\n    this._request(params, 'smartPostClose', 'CloseService_v4.wsdl', resource, (err, res) => {\n      return cb(err, res);\n    });\n  }\n\n  groundclose(params, cb) {\n    const resource = {\n      version: {\n        ServiceId: 'clos',\n        Major: 4,\n        Intermediate: 0,\n        Minor: 0,\n      },\n    };\n\n    this._request(params, 'groundClose', 'CloseService_v4.wsdl', resource, (err, res) => {\n      return cb(err, res);\n    });\n  }\n\n  serviceOptions(service, cb) {\n    if (!this.serviceTypes[service]) {\n      return cb([{ error: 'service not found' }], null);\n    }\n\n    return cb(null, this.serviceTypes[service].options);\n  }\n\n  serviceDescription(service, cb) {\n    if (!this.serviceTypes[service]) {\n      return cb([{ error: 'service not found' }], null);\n    }\n\n    return cb(null, this.serviceTypes[service].description);\n  }\n\n  signatureOptionDescription(code, cb) {\n    const serviceOption = _.find(this.SigningOptions.list, o => {\n      return o.code === code;\n    });\n\n    if (!serviceOption) {\n      return cb([{ error: 'signature option not found' }], null);\n    }\n\n    return cb(null, serviceOption.name);\n  }\n\n  _request(data, fn, wsdl, options, cb) {\n    createClient(\n      path.join(__dirname, 'wsdl', wsdl),\n      {\n        endpoint: `${this.endpoint}/web-services`,\n      },\n      (err, client) => {\n        if (err) {\n          return cb(err, null);\n        }\n\n        const params = this._generateAuthentication(data, options);\n\n        return client[fn](params, (error, result) => {\n          if (error) {\n            try {\n              return cb(error.root.Envelope.Body.Fault, null);\n            } catch (e) {\n              log('error: %o', error);\n              return cb(error, null);\n            }\n          }\n\n          log('%O', client.lastRequest);\n          return cb(err, result);\n        });\n      },\n    );\n  }\n\n  _generateAuthentication(data, options) {\n    const params = {\n      WebAuthenticationDetail: {\n        UserCredential: {\n          Key: this.key,\n          Password: this.password,\n        },\n      },\n      ClientDetail: {\n        AccountNumber: this.account_number,\n        MeterNumber: this.meter_number,\n      },\n    };\n\n    if (options && options.version) {\n      params.Version = {\n        ServiceId: options.version.ServiceId,\n        Major: options.version.Major,\n        Intermediate: options.version.Intermediate,\n        Minor: options.version.Minor,\n      };\n    }\n\n    return _.extend(params, data);\n  }\n}\n"],"file":"index.js"}